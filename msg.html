<html>
  <head>
    <title>Handheld App</title>
    <link rel="stylesheet" href="./css/vehicle.css" />
    <link rel="stylesheet" href="./css/main.css" />
    <link rel="stylesheet" href="./js/leaflet/leaflet.css" />
    <!--[if lte IE 8]>
      <link rel="stylesheet" src="./css/leaflet.ie.css" />
    <![endif]-->
    <script type="text/javascript" src="./js/webinos.js"></script>
    <script type="text/javascript" src="./js/leaflet/leaflet.js"></script>
    <script type="text/javascript" src="./js/jquery-1.8.2.min.js"></script>
    <script type="text/javascript" src="./js/tum.gr-logistics.messaging.js"></script>
    <script type="text/javascript">
      $(document).ready(function () {
        var handleMessage = function(message) {
          if(message.contents.type == "unicast" && message.contents.id != webinos.session.getPZPId()) {
              //unicast message with wrong receipient id.
              return;
          }
          $('#msg_receive').append(message.contents.message + "<br><br>");
        }
        
        var messaging = new GRMessaging(function() {
          messaging.searchChannel();
        }, function(message) {
          console.log("== Received message!");
          handleMessage(message);
        });

        $('#btn_send').click(function(){messaging.sendBroadcast();});
        $('#btn_reconnect').click(function(){connectToNextChannel();});

      });
    </script>
  </head>
  <body>
    <h1>Handheld App</h1>
    <div id="messaging">
      <h3>Outgoing message:</h3>
      <textarea id="msg_send" class="message">Hello World!</textarea>
      <input type="button" id="btn_send" value="Send Message">
      <input type="button" id="btn_reconnect" value="Reconnect">
      <h3>Incoming messages:</h3>
      <div id="msg_receive" class="message"></div>
      <input type="button" id="btn_clr_received" value="Clear">
    </div>
  </body>
</html>
